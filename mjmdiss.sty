%% mjmdiss.sty %%
%% Style file for the dissertation.

\ProvidesPackage{mjmdiss}

% misc. TeX settings
% ------------------
\widowpenalty=10000
\clubpenalty=10000
\setlength{\parindent}{0pt}
% \setlength{\parskip}{6pt plus 2pt minus 1pt}
% \setlength{\emergencystretch}{3em}  % prevent overfull lines
% \setcounter{secnumdepth}{0}
\usepackage{xspace}

% page layout
% -----------
\usepackage[margin=1in,headheight=.5in]{geometry}

\usepackage{setspace}
\doublespacing
\raggedright
\parindent=2em

% bibliography
% ------------
\usepackage[
  backend=biber,
  notes,
  parentracker=true
]{biblatex-chicago}

% footnotes
% ------------
\usepackage{sepfootnotes}
\newfootnotes{f}
\newcommand{\fn}{\fnote}
\newcommand{\fntext}{\fnotecontent}

% blank footnote comments
\newcommand\blankfootnote[1]{%
  \begingroup
  \renewcommand\thefootnote{}\footnote{\hspace{-2em}#1}%
  \addtocounter{footnote}{-1}%
  \endgroup
}

\usepackage[ragged, bottom, splitrule]{footmisc}
\setlength{\skip\footins}{14pt}
\renewcommand{\footnotelayout}{\raggedright}

% fonts
% -----------
\usepackage{amssymb,amsmath}
\usepackage{fixltx2e} % provides \textsubscript

\usepackage{mathspec}
\usepackage{xltxtra,xunicode}
\defaultfontfeatures{%
  Mapping=tex-text,%
  Scale=MatchUppercase,
  SmallCapsFeatures={
    LetterSpace=5.0,
    Letters = SmallCaps
  }
}

\setmainfont[Numbers={OldStyle}]{Junicode}
\setmathfont(Digits){Junicode}
\setmathsfont(Latin){Junicode}
\setmathrm{Junicode}
\setmathsfont(Symbols){XITS Math}
\fontsize{12pt}{12pt}

\newfontfamily\liningNums{Junicode}
\newfontfamily\sscaptionfont[
    Numbers=OldStyle,
    SmallCapsFeatures={LetterSpace=3.0},
]{Source Sans Pro}
\newfontfamily\ssliningfont[Numbers=Proportional]{Fira Sans}

\newfontface\abbrevSC[Letters=UppercaseSmallCaps,LetterSpace=5.0]{Junicode}

\usepackage{subscript}    % for \textsubscript
\usepackage{paralist}
\newcommand{\degree}{\ensuremath{^\circ}}

\usepackage[
  leftmargin = 2em,
  rightmargin = 2em,
  vskip = \partopsep
]{quoting}

% section headings
% ----------------
\usepackage{titling}
\usepackage{titlesec}
\titleformat{\chapter}[display]{%
  \normalfont\large\scshape}
  {\chaptertitlename\ \thechapter}{0pt}{\vspace{-2ex}\LARGE\upshape}{}
\titlespacing*{\chapter}{0pt}{0pt}{1em}

\titleformat*{\section}{\large}
\titleformat*{\subsection}{\normalsize\scshape}

% page header
% -----------
\usepackage{fancyhdr}
\pagestyle{fancy}
% \setlength{\headheight}{14pt}

\lhead{}
\chead{}
\rhead{\tiny{\today\ \currenttime}}
\lfoot{}
\cfoot{\thepage}
\rfoot{}
\renewcommand{\headrulewidth}{0pt}

% hyperref
% --------
% (Provides PDF table of contents)
\usepackage[unicode,bookmarks,bookmarksnumbered,pdfencoding=auto,hyperfootnotes=false,linktocpage]{hyperref}
\urlstyle{same}

% examples/captions
% -----------------
\usepackage{newfloat}
\DeclareFloatingEnvironment[
  name={Example},
  placement=htbp
]{example}

\usepackage[section]{placeins}
\usepackage{float}

% provide opts to includegraphics as optional arg
\newcommand{\centerGraphic}[2][]{%
  \begin{center}%
    \includegraphics[#1]{#2}%
  \end{center}%
}


\usepackage{caption}
\DeclareCaptionFont{sansserif}{\sscaptionfont\footnotesize}
\captionsetup{
  format = plain,
  labelsep = period,
  font=sansserif,
  margin=2em,
  justification = raggedright,
  singlelinecheck = false,
}


\usepackage{marginnote}
\newcommand{\sidenote}[1]{\marginnote{\singlespacing\footnotesize#1}}

% misc. formatting
% ----------------
\usepackage{datetime}
\yyyymmdddate
\renewcommand{\dateseparator}{-}
\usepackage[chicago]{ellipsis}      % better spaced ellipses

% command for removing extra vertical space in math envs
\newcommand{\novspace}{%
    \setlength{\abovedisplayskip}{.5em plus 3pt minus 3pt}%
    \setlength{\belowdisplayskip}{.5em plus 3pt minus 3pt}%
}

% proposal-specific
% -----------------

% scale degrees /music stuff
\newcommand{\sd}[1]{\ensuremath{\hat{#1}}}
\renewcommand{\flat}{{\fontspec[Scale=MatchUppercase]{Times + Musical}f}}
\renewcommand{\sharp}{{\fontspec[Scale=MatchUppercase]{Times + Musical}s}}
\newcommand{\nat}{{\fontspec[Scale=MatchUppercase]{Times + Musical}n}}

% kerning on these characters sucks, so define some kern lengths
\newcommand{\fklen}{0.5pt}
\newcommand{\sklen}{0.4pt}
\newcommand{\flatkern}{\hspace{\fklen}}
\newcommand{\sharpkern}{\hspace{\sklen}}

\newcommand{\Bflat}{\mbox{B\flatkern\flat\sharpkern}}
\newcommand{\Eflat}{\mbox{E\flatkern\flat\sharpkern}}
\newcommand{\Aflat}{\mbox{A\flatkern\flat\sharpkern}}
\newcommand{\Dflat}{\mbox{D\flatkern\flat\sharpkern}}
\newcommand{\Gflat}{\mbox{G\flatkern\flat\sharpkern}}
\newcommand{\Cflat}{\mbox{C\flatkern\flat\sharpkern}}
\newcommand{\Fflat}{\mbox{F\flatkern\flat\sharpkern}}

% Define a new command, \h, that prints a harmony.
% It substitutes all 's' chars with sharps, and all 'b' chars with flats.
% Also adds some padding before the special chars and wraps them in an mbox{}
% so that they don't get split across lines
%
% Ex: \h{Fsm7b5} --> \mbox{F\hspace{1.25pt}\sharp{}m7\hspace{1.25pt}\flat{}5}
\usepackage{xstring}
\newcommand{\h}[1]{%
  {%
    \liningNums%
  \mbox{%
    \StrSubstitute{#1}{s}{\sharp{}}[\x]%
    \StrSubstitute{\x}{b}{\flat{}}[\x]%
    \StrSubstitute{\x}{o}{\degree{}}[\x]%
    \expandarg%
    \StrSubstitute{\x}{\flat}{\hspace{\fklen}\flat}[\x]%
    \StrSubstitute{\x}{\sharp}{\hspace{\sklen}\sharp}[\x]%
    \x%
  }%
  }%
}

% caption harmony
\newcommand{\caph}[1]{%
  {%
    \ssliningfont%
  \mbox{%
    \StrSubstitute{#1}{s}{\sharp{}}[\x]%
    \StrSubstitute{\x}{b}{\flat{}}[\x]%
    \StrSubstitute{\x}{o}{\degree{}}[\x]%
    \expandarg%
    \StrSubstitute{\x}{\flat}{\hspace{\fklen}\flat}[\x]%
    \StrSubstitute{\x}{\sharp}{\hspace{\sklen}\sharp}[\x]%
    \x%
  }%
  }%
}

% text shortcuts
\newcommand{\tf}{\mbox{ii--V}\xspace}
\newcommand{\tfo}{\mbox{ii--V--I}\xspace}
\newcommand{\tfmo}{\mbox{ii--V--i}\xspace}
\newcommand{\tft}{TF\tsub{T}\xspace}
\newcommand{\tfmt}{tf\tsub{T}\xspace}
\newcommand{\slideS}{\abbrev{SLIDE}\textsuperscript{7}\xspace}
\newcommand{\tsub}{\textsubscript}
\newcommand{\tsup}{\textsuperscript}
\newcommand{\rightparen}{)}
\newcommand{\ivls}{\abbrev{IVLS}\xspace}
\newcommand{\gis}{\abbrev{GIS}\xspace}
\newcommand{\strans}{\abbrev{STRANS}\xspace}

% uppercase small caps
\newcommand{\abbrev}[1]{{\abbrevSC #1}}

% math shortcuts
\newcommand{\lra}{\longrightarrow}
\newcommand{\TFarrow}{\ensuremath{\xrightarrow{\mathrm{TF}}}}
\newcommand{\TFTarrow}{\ensuremath{\xrightarrow{\mathrm{TF}_\mathrm{T}}}}
\newcommand{\ECarrow}{\ensuremath{\xrightarrow{\mathrm{EC}}}}
\newcommand{\ECTarrow}{\ensuremath{\xrightarrow{\mathrm{EC}_\mathrm{T}}}}
\newcommand{\intZ}{\ensuremath{\mathbb{Z}}}

\newcommand{\Smin}{\ensuremath{S_{\mathrm{min}}}\xspace}
\newcommand{\Sdom}{\ensuremath{S_{\mathrm{dom}}}\xspace}
\newcommand{\Smaj}{\ensuremath{S_{\mathrm{maj}}}\xspace}
\newcommand{\SmM}{\ensuremath{S_{\mathrm{mM7}}}\xspace}

%% end mjmdiss.sty %%
